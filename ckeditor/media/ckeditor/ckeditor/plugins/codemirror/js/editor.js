var internetExplorer=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent),webkit=/AppleWebKit/.test(navigator.userAgent),safari=/Apple Computers, Inc/.test(navigator.vendor),gecko=/gecko\/(\d{8})/i.test(navigator.userAgent),brokenOpera=window.opera&&/Version\/10.[56]/.test(navigator.userAgent);function makeWhiteSpace(p){for(var t=[],u=true;p>0;p--){t.push(u||p==1?nbsp:" ");u^=true}return t.join("")}
function fixSpaces(p){if(p.charAt(0)==" ")p=nbsp+p.slice(1);return p.replace(/\t/g,function(){return makeWhiteSpace(indentUnit)}).replace(/[ \u00a0]{2,}/g,function(t){return makeWhiteSpace(t.length)})}function cleanText(p){return p.replace(/\u00a0/g," ")}function makePartSpan(p,t){var u=p;if(p.nodeType==3)u=p.nodeValue;else p=t.createTextNode(u);var q=t.createElement("SPAN");q.isPart=true;q.appendChild(p);q.currentText=u;return q}
var Editor=function(){function p(a){var b=makeWhiteSpace(indentUnit);return map(a.replace(/\t/g,b).replace(/\u00a0/g," ").replace(/\r\n?/g,"\n").split("\n"),fixSpaces)}function t(a,b){function c(d,i){if(d.nodeType==3){if((d.nodeValue=fixSpaces(d.nodeValue.replace(/\r/g,"").replace(/\n/g," "))).length)h=false;e.push(d)}else if(isBR(d)&&d.childNodes.length==0){h=true;e.push(d)}else{for(var g=d.firstChild;g;g=g.nextSibling)c(g);if(!h&&B.hasOwnProperty(d.nodeName.toUpperCase())){h=true;if(!b||!i)e.push(f.createElement("BR"))}}}
var f=a.ownerDocument,e=[],h=true;c(a,true);return e}function u(a){function b(d){var i=d.parentNode,g=d.nextSibling;return function(k){i.insertBefore(k,g)}}var c=a.ownerDocument,f=[],e=null,h=true;return{next:function(){if(!a)throw StopIteration;var d=a;a=d.nextSibling;var i;if(d.isPart&&d.childNodes.length==1&&d.firstChild.nodeType==3){d.currentText=d.firstChild.nodeValue;i=!/[\n\t\r]/.test(d.currentText)}else i=false;if(i){f.push(d);h=false;return d.currentText}else if(isBR(d)){h&&window.opera&&
d.parentNode.insertBefore(makePartSpan("",c),d);f.push(d);h=true;return"\n"}else{i=!d.nextSibling;e=b(d);removeElement(d);d=t(d,i);for(i=0;i<d.length;i++){var g=d,k=i,n=d[i],l="\n";if(n.nodeType==3){select.snapshotChanged();n=makePartSpan(n,c);l=n.currentText;h=false}else{h&&window.opera&&e(makePartSpan("",c));h=true}n.dirty=true;f.push(n);e(n);g[k]=l}return d.join("")}},nodes:f}}function q(a){for(;a&&!isBR(a);)a=a.previousSibling;return a}function v(a,b){if(a){if(isBR(a))a=a.nextSibling}else a=b.firstChild;
for(;a&&!isBR(a);)a=a.nextSibling;return a}function z(a,b,c,f){function e(d){d=cleanText(a.history.textAfter(d));return f?d.toLowerCase():d}this.editor=a;this.history=a.history;this.history.commit();this.valid=!!b;this.atOccurrence=false;if(f==undefined)f=b==b.toLowerCase();if(c&&typeof c=="object"&&typeof c.character=="number"){a.checkLine(c.line);c={node:c.line,offset:c.character};this.pos={from:c,to:c}}else if(c)this.pos={from:select.cursorPos(a.container,true),to:select.cursorPos(a.container,
false)};else{c={node:null,offset:0};this.pos={from:c,to:c}}var h=(this.caseFold?b.toLowerCase():b).split("\n");this.matches=h.length==1?function(d,i,g){var k=e(i),n=b.length,l;if(d?g>=n&&(l=k.lastIndexOf(b,g-n))!=-1:(l=k.indexOf(b,g))!=-1)return{from:{node:i,offset:l},to:{node:i,offset:l+n}}}:function(d,i,g){var k=d?h.length-1:0,n=h[k],l=e(i),m=d?l.indexOf(n)+n.length:l.lastIndexOf(n);if(!(d?m>=g||m!=n.length:m<=g||m!=l.length-n.length))for(g=i;;){if(d&&!g)return;g=d?this.history.nodeBefore(g):this.history.nodeAfter(g);
if(!d&&!g)return;l=e(g);n=h[d?--k:++k];if(k>0&&k<h.length-1)if(l!=n)return;else continue;k=d?l.lastIndexOf(n):l.indexOf(n)+n.length;if(d?k!=l.length-n.length:k!=n.length)return;return{from:{node:d?g:i,offset:d?k:m},to:{node:d?i:g,offset:d?m:k}}}}}function r(a){this.options=a;window.indentUnit=a.indentUnit;this.parent=parent;this.doc=document;var b=this.container=this.doc.body;this.win=window;this.history=new UndoHistory(b,a.undoDepth,a.undoDelay,this);var c=this;if(!r.Parser)throw"No parser loaded.";
a.parserConfig&&r.Parser.configure&&r.Parser.configure(a.parserConfig);a.readOnly||select.setCursorPos(b,{node:null,offset:0});this.dirty=[];this.importCode(a.content||"");this.history.onChange=a.onChange;if(a.readOnly){if(!a.textWrapping)b.style.whiteSpace="nowrap"}else{if(a.continuousScanning!==false){this.scanner=this.documentScanner(a.passTime);this.delayScanning()}var f=function(){if(document.body.contentEditable!=undefined&&internetExplorer)document.body.contentEditable="true";else document.designMode=
"on";if(internetExplorer&&a.height!="dynamic")document.body.style.minHeight=a.height;document.documentElement.style.borderWidth="0";if(!a.textWrapping)b.style.whiteSpace="nowrap"};try{f()}catch(e){var h=addEventHandler(document,"focus",function(){h();f()},true)}addEventHandler(document,"keydown",method(this,"keyDown"));addEventHandler(document,"keypress",method(this,"keyPress"));addEventHandler(document,"keyup",method(this,"keyUp"));var d=function(){c.cursorActivity(false)};addEventHandler(document.body,
"mouseup",d);addEventHandler(document.body,"cut",d);gecko&&addEventHandler(this.win,"pagehide",function(){c.unloaded=true});addEventHandler(document.body,"paste",function(i){d();var g=null;try{var k=i.clipboardData||window.clipboardData;if(k)g=k.getData("Text")}catch(n){}if(g!==null){i.stop();c.replaceSelection(g);select.scrollToCursor(c.container)}});this.options.autoMatchParens&&addEventHandler(document.body,"click",method(this,"scheduleParenHighlight"))}}var B={P:true,DIV:true,LI:true};z.prototype=
{findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(a){function b(){var d={node:e,offset:h};c.pos={from:d,to:d};return c.atOccurrence=false}if(!this.valid)return false;var c=this,f=a?this.pos.from:this.pos.to,e=f.node,h=f.offset;if(e&&!e.parentNode){e=null;h=0}for(;;){if(this.pos=this.matches(a,e,h))return this.atOccurrence=true;if(a){if(!e)return b();e=this.history.nodeBefore(e);h=this.history.textAfter(e).length}else{f=this.history.nodeAfter(e);
if(!f){h=this.history.textAfter(e).length;return b()}e=f;h=0}}},select:function(){if(this.atOccurrence){select.setCursorPos(this.editor.container,this.pos.from,this.pos.to);select.scrollToCursor(this.editor.container)}},replace:function(a){if(this.atOccurrence){this.pos.to=this.editor.replaceRange(this.pos.from,this.pos.to,a);this.atOccurrence=false}},position:function(){if(this.atOccurrence)return{line:this.pos.from.node,character:this.pos.from.offset}}};r.prototype={importCode:function(a){this.history.push(null,
null,p(a));this.history.reset()},getCode:function(){if(!this.container.firstChild)return"";var a=[];select.markSelection(this.win);forEach(u(this.container.firstChild),method(a,"push"));select.selectMarked();return cleanText(a.join(""))},checkLine:function(a){if(a===false||!(a==null||a.parentNode==this.container))throw parent.CodeMirror.InvalidLineHandle;},cursorPosition:function(a){if(a==null)a=true;return(a=select.cursorPos(this.container,a))?{line:a.node,character:a.offset}:{line:null,character:0}},
firstLine:function(){return null},lastLine:function(){return this.container.lastChild?q(this.container.lastChild):null},nextLine:function(a){this.checkLine(a);return v(a,this.container)||false},prevLine:function(a){this.checkLine(a);if(a==null)return false;return q(a.previousSibling)},visibleLineCount:function(){for(var a=this.container.firstChild;a&&isBR(a);)a=a.nextSibling;if(!a)return false;return Math.floor((window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)/
a.offsetHeight)},selectLines:function(a,b,c,f){this.checkLine(a);a={node:a,offset:b};b=null;if(f!==undefined){this.checkLine(c);b={node:c,offset:f}}select.setCursorPos(this.container,a,b);select.scrollToCursor(this.container)},lineContent:function(a){var b=[];for(a=a?a.nextSibling:this.container.firstChild;a&&!isBR(a);a=a.nextSibling)b.push(nodeText(a));return cleanText(b.join(""))},setLineContent:function(a,b){this.history.commit();this.replaceRange({node:a,offset:0},{node:a,offset:this.history.textAfter(a).length},
b);this.addDirtyNode(a);this.scheduleHighlight()},removeLine:function(a){for(var b=a?a.nextSibling:this.container.firstChild;b;){var c=b.nextSibling;removeElement(b);if(isBR(b))break;b=c}this.addDirtyNode(a);this.scheduleHighlight()},insertIntoLine:function(a,b,c){var f=null;if(b=="end")f=v(a,this.container);else for(var e=a?a.nextSibling:this.container.firstChild;e;e=e.nextSibling){if(b==0){f=e;break}var h=nodeText(e);if(h.length>b){f=e.nextSibling;c=h.slice(0,b)+c+h.slice(b);removeElement(e);break}b-=
h.length}b=p(c);c=this.container.ownerDocument;for(e=0;e<b.length;e++){e>0&&this.container.insertBefore(c.createElement("BR"),f);this.container.insertBefore(makePartSpan(b[e],c),f)}this.addDirtyNode(a);this.scheduleHighlight()},selectedText:function(){var a=this.history;a.commit();var b=select.cursorPos(this.container,true),c=select.cursorPos(this.container,false);if(!b||!c)return"";if(b.node==c.node)return a.textAfter(b.node).slice(b.offset,c.offset);var f=[a.textAfter(b.node).slice(b.offset)];for(b=
a.nodeAfter(b.node);b!=c.node;b=a.nodeAfter(b))f.push(a.textAfter(b));f.push(a.textAfter(c.node).slice(0,c.offset));return cleanText(f.join("\n"))},replaceSelection:function(a){this.history.commit();var b=select.cursorPos(this.container,true),c=select.cursorPos(this.container,false);if(b&&c){c=this.replaceRange(b,c,a);select.setCursorPos(this.container,c)}},cursorCoords:function(a){function b(i,g){var k=-(d.win.document.body.scrollTop||d.win.document.documentElement.scrollTop||0),n=-(d.win.document.body.scrollLeft||
d.win.document.documentElement.scrollLeft||0)+g;forEach([i,d.win.frameElement],function(l){for(;l;){n+=l.offsetLeft;k+=l.offsetTop;l=l.offsetParent}});return{x:n,y:k,yBot:k+i.offsetHeight}}function c(i,g){var k=h.createElement("SPAN");k.appendChild(h.createTextNode(i));try{return g(k)}finally{k.parentNode&&k.parentNode.removeChild(k)}}var f=select.cursorPos(this.container,a);if(!f)return null;a=f.offset;for(var e=f.node,h=this.win.document,d=this;a;){e=e?e.nextSibling:this.container.firstChild;f=
nodeText(e);if(a<f.length)return c(f.substr(0,a),function(i){i.style.position="absolute";i.style.visibility="hidden";i.className=e.className;d.container.appendChild(i);return b(e,i.offsetWidth)});a-=f.length}return e&&isSpan(e)?b(e,e.offsetWidth):e&&e.nextSibling&&isSpan(e.nextSibling)?b(e.nextSibling,0):c("\u200b",function(i){e?e.parentNode.insertBefore(i,e.nextSibling):d.container.insertBefore(i,d.container.firstChild);return b(i,0)})},reroutePasteEvent:function(){if(!(this.capturingPaste||window.opera)){this.capturingPaste=
true;var a=window.frameElement.CodeMirror.textareaHack;parent.focus();a.value="";a.focus();var b=this;this.parent.setTimeout(function(){b.capturingPaste=false;b.win.focus();b.selectionSnapshot&&b.win.select.setBookmark(b.container,b.selectionSnapshot);var c=a.value;if(c){b.replaceSelection(c);select.scrollToCursor(b.container)}},10)}},replaceRange:function(a,b,c){c=p(c);c[0]=this.history.textAfter(a.node).slice(0,a.offset)+c[0];var f=c[c.length-1];c[c.length-1]=f+this.history.textAfter(b.node).slice(b.offset);
b=this.history.nodeAfter(b.node);this.history.push(a.node,b,c);return{node:this.history.nodeBefore(b),offset:f.length}},getSearchCursor:function(a,b,c){return new z(this,a,b,c)},reindent:function(){this.container.firstChild&&this.indentRegion(null,this.container.lastChild)},reindentSelection:function(a){if(select.somethingSelected(this.win)){var b=select.selectionTopNode(this.container,true),c=select.selectionTopNode(this.container,false);b===false||c===false||this.indentRegion(b,c,a)}else this.indentAtCursor(a)},
grabKeys:function(a,b){this.frozen=a;this.keyFilter=b},ungrabKeys:function(){this.frozen="leave"},setParser:function(a,b){r.Parser=window[a];(b=b||this.options.parserConfig)&&r.Parser.configure&&r.Parser.configure(b);if(this.container.firstChild){forEach(this.container.childNodes,function(c){if(c.nodeType!=3)c.dirty=true});this.addDirtyNode(this.firstChild);this.scheduleHighlight()}},keyDown:function(a){if(this.frozen=="leave")this.keyFilter=this.frozen=null;if(this.frozen&&(!this.keyFilter||this.keyFilter(a.keyCode,
a))){a.stop();this.frozen(a)}else{var b=a.keyCode;this.delayScanning();this.options.autoMatchParens&&this.scheduleParenHighlight();if(b==13){if(a.ctrlKey&&!a.altKey)this.reparseBuffer();else{select.insertNewlineAtCursor(this.win);b=this.options.enterMode;if(b!="flat")this.indentAtCursor(b=="keep"?"keep":undefined);select.scrollToCursor(this.container)}a.stop()}else if(b==9&&this.options.tabMode!="default"&&!a.ctrlKey){this.handleTab(!a.shiftKey);a.stop()}else if(b==32&&a.shiftKey&&this.options.tabMode==
"default"){this.handleTab(true);a.stop()}else if(b==36&&!a.shiftKey&&!a.ctrlKey)this.home()&&a.stop();else if(b==35&&!a.shiftKey&&!a.ctrlKey)this.end()&&a.stop();else if(b==33&&!a.shiftKey&&!a.ctrlKey&&!gecko)this.pageUp()&&a.stop();else if(b==34&&!a.shiftKey&&!a.ctrlKey&&!gecko)this.pageDown()&&a.stop();else if((b==219||b==221)&&a.ctrlKey&&!a.altKey){this.highlightParens(a.shiftKey,true);a.stop()}else if(a.metaKey&&!a.shiftKey&&(b==37||b==39)){var c=select.selectionTopNode(this.container);if(!(c===
false||!this.container.firstChild)){if(b==37)select.focusAfterNode(q(c),this.container);else{b=v(c,this.container);select.focusAfterNode(b?b.previousSibling:this.container.lastChild,this.container)}a.stop()}}else if((a.ctrlKey||a.metaKey)&&!a.altKey)if(a.shiftKey&&b==90||b==89){select.scrollToNode(this.history.redo());a.stop()}else if(b==90||safari&&b==8){select.scrollToNode(this.history.undo());a.stop()}else if(b==83&&this.options.saveFunction){this.options.saveFunction();a.stop()}else b==86&&this.reroutePasteEvent()}},
keyPress:function(a){var b=this.options.electricChars&&r.Parser.electricChars,c=this;if(this.frozen&&(!this.keyFilter||this.keyFilter(a.keyCode||a.code,a))||a.code==13||a.code==9&&this.options.tabMode!="default"||a.code==32&&a.shiftKey&&this.options.tabMode=="default")a.stop();else if(b&&b.indexOf(a.character)!=-1)this.parent.setTimeout(function(){c.indentAtCursor(null)},0);else if(brokenOpera)if(a.code==8){var f=select.selectionTopNode(this.container);c=this;var e=f?f.nextSibling:this.container.firstChild;
f!==false&&e&&isBR(e)&&this.parent.setTimeout(function(){select.selectionTopNode(c.container)==e&&select.focusAfterNode(e.previousSibling,c.container)},20)}else if(a.code==46){f=select.selectionTopNode(this.container);c=this;f&&isBR(f)&&this.parent.setTimeout(function(){select.selectionTopNode(c.container)!=f&&select.focusAfterNode(f,c.container)},20)}},keyUp:function(a){this.cursorActivity(a.keyCode>=16&&a.keyCode<=18||a.keyCode>=33&&a.keyCode<=40)},indentLineAfter:function(a,b){function c(k){k=
k?k.nextSibling:f.container.firstChild;if(!k||!hasClass(k,"whitespace"))return null;return k}var f=this,e=c(a),h=0,d=e?e.currentText.length:0;if(b=="keep"){if(a){var i=c(q(a.previousSibling));if(i)h=i.currentText.length}}else{var g=e?e.nextSibling:a?a.nextSibling:this.container.firstChild;i=a&&g&&g.currentText?g.currentText:"";if(b!=null&&this.options.tabMode=="shift")h=b?d+indentUnit:Math.max(0,d-indentUnit);else if(a)h=a.indentation(i,d,b);else if(r.Parser.firstIndentation)h=r.Parser.firstIndentation(i,
d,b)}d=h-d;if(d<0)if(h==0){if(g)select.snapshotMove(e.firstChild,g.firstChild||g,0);removeElement(e);e=null}else{select.snapshotMove(e.firstChild,e.firstChild,d,true);e.currentText=makeWhiteSpace(h);e.firstChild.nodeValue=e.currentText}else if(d>0)if(e){e.currentText=makeWhiteSpace(h);e.firstChild.nodeValue=e.currentText;select.snapshotMove(e.firstChild,e.firstChild,d,true)}else{e=makePartSpan(makeWhiteSpace(h),this.doc);e.className="whitespace";a?insertAfter(e,a):this.container.insertBefore(e,this.container.firstChild);
select.snapshotMove(g&&(g.firstChild||g),e.firstChild,h,false,true)}else e&&select.snapshotMove(e.firstChild,e.firstChild,h,false);d!=0&&this.addDirtyNode(a)},highlightAtCursor:function(){var a=select.selectionTopNode(this.container,true),b=select.selectionTopNode(this.container,false);if(a===false||b===false)return false;select.markSelection(this.win);if(this.highlight(a,v(b,this.container),true,20)===false)return false;select.selectMarked();return true},handleTab:function(a){this.options.tabMode==
"spaces"?select.insertTabAtCursor(this.win):this.reindentSelection(a)},home:function(){var a=select.selectionTopNode(this.container,true),b=a;if(a===false||!(!a||a.isPart||isBR(a))||!this.container.firstChild)return false;for(;a&&!isBR(a);)a=a.previousSibling;var c=a?a.nextSibling:this.container.firstChild;c&&c!=b&&c.isPart&&hasClass(c,"whitespace")?select.focusAfterNode(c,this.container):select.focusAfterNode(a,this.container);select.scrollToCursor(this.container);return true},end:function(){var a=
select.selectionTopNode(this.container,true);if(a===false)return false;a=v(a,this.container);if(!a)return false;select.focusAfterNode(a.previousSibling,this.container);select.scrollToCursor(this.container);return true},pageUp:function(){var a=this.cursorPosition().line,b=this.visibleLineCount();if(a===false||b===false)return false;b-=2;for(var c=0;c<b;c++){a=this.prevLine(a);if(a===false)break}if(c==0)return false;select.setCursorPos(this.container,{node:a,offset:0});select.scrollToCursor(this.container);
return true},pageDown:function(){var a=this.cursorPosition().line,b=this.visibleLineCount();if(a===false||b===false)return false;b-=2;for(var c=0;c<b;c++){var f=this.nextLine(a);if(f===false)break;a=f}if(c==0)return false;select.setCursorPos(this.container,{node:a,offset:0});select.scrollToCursor(this.container);return true},scheduleParenHighlight:function(){this.parenEvent&&this.parent.clearTimeout(this.parenEvent);var a=this;this.parenEvent=this.parent.setTimeout(function(){a.highlightParens()},
300)},highlightParens:function(a,b){function c(m,s){if(m)if(d.options.markParen)d.options.markParen(m,s);else{m.style.fontWeight="bold";m.style.color=s?"#8F8":"#F88"}}function f(m){if(m)if(d.options.unmarkParen)d.options.unmarkParen(m);else{m.style.fontWeight="";m.style.color=""}}function e(m){if(m.currentText)return(m=m.currentText.match(/^[\s\u00a0]*([\(\)\[\]{}])[\s\u00a0]*$/))&&m[1]}function h(){for(var m=[],s,w=true,j=g;j;j=n?j.nextSibling:j.previousSibling)if(j.className==k&&isSpan(j)&&(s=e(j))){if(/[\(\[\{]/.test(s)==
n)m.push(s);else if(m.length){if(m.pop()!=matching[s])w=false}else w=false;if(!m.length)break}else if(j.dirty||!isSpan(j)&&!isBR(j))return{node:j,status:"dirty"};return{node:j,status:j&&w}}var d=this;if(!b&&d.highlighted){f(d.highlighted[0]);f(d.highlighted[1])}if(window.parent&&window.select){this.parenEvent&&this.parent.clearTimeout(this.parenEvent);this.parenEvent=null;var i,g=select.selectionTopNode(this.container,true);if(g&&this.highlightAtCursor())if((g=select.selectionTopNode(this.container,
true))&&((i=e(g))||(g=g.nextSibling)&&(i=e(g))))for(var k=g.className,n=/[\(\[\{]/.test(i);;){var l=h();if(l.status=="dirty"){this.highlight(l.node,v(l.node));l.node.dirty=false}else{c(g,l.status);c(l.node,l.status);if(b)d.parent.setTimeout(function(){f(g);f(l.node)},500);else d.highlighted=[g,l.node];a&&l.node&&select.focusAfterNode(l.node.previousSibling,this.container);break}}}},indentAtCursor:function(a){if(this.container.firstChild)if(this.highlightAtCursor()){var b=select.selectionTopNode(this.container,
false);if(b!==false){select.markSelection(this.win);this.indentLineAfter(q(b),a);select.selectMarked()}}},indentRegion:function(a,b,c){var f=a=q(a),e=a&&q(a.previousSibling);isBR(b)||(b=v(b,this.container));this.addDirtyNode(a);do{var h=v(f,this.container);f&&this.highlight(e,h,true);this.indentLineAfter(f,c);e=f;f=h}while(f!=b);select.setCursorPos(this.container,{node:a,offset:0},{node:b,offset:0})},cursorActivity:function(a){if(this.unloaded){this.win.document.designMode="off";this.win.document.designMode=
"on";this.unloaded=false}if(internetExplorer){this.container.createTextRange().execCommand("unlink");this.selectionSnapshot=select.getBookmark(this.container)}var b=this.options.cursorActivity;if(!a||b){var c=select.selectionTopNode(this.container,false);if(!(c===false||!this.container.firstChild)){c=c||this.container.firstChild;b&&b(c);if(!a){this.scheduleHighlight();this.addDirtyNode(c)}}}},reparseBuffer:function(){forEach(this.container.childNodes,function(a){a.dirty=true});this.container.firstChild&&
this.addDirtyNode(this.container.firstChild)},addDirtyNode:function(a){if(a=a||this.container.firstChild){for(var b=0;b<this.dirty.length;b++)if(this.dirty[b]==a)return;if(a.nodeType!=3)a.dirty=true;this.dirty.push(a)}},allClean:function(){return!this.dirty.length},scheduleHighlight:function(){var a=this;this.parent.clearTimeout(this.highlightTimeout);this.highlightTimeout=this.parent.setTimeout(function(){a.highlightDirty()},this.options.passDelay)},getDirtyNode:function(){for(;this.dirty.length>
0;){var a=this.dirty.pop();try{for(;a&&a.parentNode!=this.container;)a=a.parentNode;if(a&&(a.dirty||a.nodeType==3))return a}catch(b){}}return null},highlightDirty:function(a){if(!window.parent||!window.select)return false;this.options.readOnly||select.markSelection(this.win);for(var b,c=a?null:(new Date).getTime()+this.options.passTime;((new Date).getTime()<c||a)&&(b=this.getDirtyNode());){var f=this.highlight(b,c);f&&f.node&&f.dirty&&this.addDirtyNode(f.node.nextSibling)}this.options.readOnly||select.selectMarked();
b&&this.scheduleHighlight();return this.dirty.length==0},documentScanner:function(a){var b=this,c=null;return function(){if(window.parent&&window.select){if(c&&c.parentNode!=b.container)c=null;select.markSelection(b.win);var f=b.highlight(c,(new Date).getTime()+a,true);select.selectMarked();f=f?f.node&&f.node.nextSibling:null;c=c==f?null:f;b.delayScanning()}}},delayScanning:function(){if(this.scanner){this.parent.clearTimeout(this.documentScan);this.documentScan=this.parent.setTimeout(this.scanner,
this.options.continuousScanning)}},highlight:function(a,b,c,f){function e(j){if(j){var o=j.oldNextSibling;if(m||o===undefined||j.nextSibling!=o)d.history.touch(j);j.oldNextSibling=j.nextSibling}else{o=d.container.oldFirstChild;if(m||o===undefined||d.container.firstChild!=o)d.history.touch(null);d.container.oldFirstChild=d.container.firstChild}}var h=this.container,d=this,i=this.options.activeTokens,g=typeof b=="number"?b:null;if(!h.firstChild)return false;for(;a&&(!a.parserFromHere||a.dirty);){if(f!=
null&&isBR(a)&&--f<0)return false;a=a.previousSibling}if(a&&!a.nextSibling)return false;var k=u(a?a.nextSibling:h.firstChild);f=stringStream(k);var n=a?a.parserFromHere(f):r.Parser.make(f),l={current:null,get:function(){if(!this.current)this.current=k.nodes.shift();return this.current},next:function(){this.current=null},remove:function(){h.removeChild(this.get());this.current=null},getNonEmpty:function(){for(var j=this.get();j&&isSpan(j)&&j.currentText=="";)if(window.opera&&(j.previousSibling==null||
isBR(j.previousSibling))&&(j.nextSibling==null||isBR(j.nextSibling))){this.next();j=this.get()}else{var o=j;this.remove();j=this.get();select.snapshotMove(o.firstChild,j&&(j.firstChild||j),0)}return j}},m=false,s=true,w=0;forEach(n,function(j){var o=l.getNonEmpty();if(j.value=="\n"){if(!isBR(o))throw"Parser out of sync. Expected BR.";if(o.dirty||!o.indentation)m=true;e(a);a=o;o.parserFromHere=n.copy();o.indentation=j.indentation;o.dirty=false;if(g==null&&o==b)throw StopIteration;if(g!=null&&(new Date).getTime()>=
g||!m&&!s&&w>1&&!c)throw StopIteration;s=m;m=false;w=0;l.next()}else{if(!isSpan(o))throw"Parser out of sync. Expected SPAN.";if(o.dirty)m=true;w++;if(!o.reduced&&o.currentText==j.value&&o.className==j.style){o.dirty=false;l.next()}else{m=true;var x=makePartSpan(j.value,d.doc);x.className=j.style;h.insertBefore(x,o);i&&i(x,j,d);j=j.value.length;for(var A=0;j>0;){o=l.get();var y=o.currentText.length;select.snapshotReplaceNode(o.firstChild,x.firstChild,j,A);if(y>j){o=o;o.currentText=o.currentText.substring(j);
o.reduced=true;j=0}else{j-=y;A+=y;l.remove()}}}}});e(a);return{node:l.getNonEmpty(),dirty:m}}};return r}();addEventHandler(window,"load",function(){var p=window.frameElement.CodeMirror;p.editor=new Editor(p.options);this.parent.setTimeout(method(p,"init"),0)});